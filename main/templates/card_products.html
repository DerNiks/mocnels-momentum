{% load static %}
{% load humanize %}

<article class="group relative overflow-hidden rounded-2xl bg-slate-800/80 border border-slate-700 hover:border-slate-600 hover:shadow-[0_10px_35px_rgba(0,0,0,0.45)] transition-all">
  <!-- Thumbnail -->
  <div class="relative aspect-[4/3] overflow-hidden">
    {% if products.thumbnail %}
      <img src="{{ products.thumbnail }}" alt="{{ products.name }}"
           class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
    {% endif %}

    <!-- bottom gradient -->
    <div class="pointer-events-none absolute inset-x-0 bottom-0 h-24 bg-gradient-to-t from-black/70 via-black/20 to-transparent"></div>

    <!-- left badges -->
    <div class="absolute top-3 left-3 flex gap-2">
      {% if products.category %}
        <span class="px-2.5 py-1 rounded-full text-[11px] font-medium bg-emerald-500 text-white shadow">
          {{ products.get_category_display }}
        </span>
      {% endif %}
      {% if products.brand %}
        <span class="px-2.5 py-1 rounded-full text-[11px] bg-slate-900/80 text-slate-200 border border-slate-700/70">
          {{ products.brand }}
        </span>
      {% endif %}
    </div>

    <!-- right badges -->
    <div class="absolute top-3 right-3 flex gap-2">
      {% if products.is_featured %}
        <span class="px-2.5 py-1 rounded-full text-[11px] font-semibold bg-yellow-400/90 text-black">Featured</span>
      {% endif %}
      {% if products.is_hot_sales %}
        <span class="px-2.5 py-1 rounded-full text-[11px] font-semibold bg-rose-500/90 text-white">Hot</span>
      {% endif %}
    </div>
  </div>

  <!-- Content -->
  <div class="p-5">
    <!-- title -->
    <h3 class="text-lg font-semibold text-slate-100 leading-tight mb-1 line-clamp-2">
      <a href="{% url 'main:show_products' products.id %}"
         class="hover:text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 rounded">
        {{ products.name }}
      </a>
    </h3>

    <!-- meta -->
    <div class="flex flex-wrap items-center gap-x-3 text-xs text-slate-400 mb-3">
      {% if products.created_at %}
        <time datetime="{{ products.created_at|date:'c' }}">{{ products.created_at|date:"M j, Y" }}</time>
      {% endif %}
      {% if products.sales_count is not None %}
        <span>â€¢ {{ products.sales_count }} sales</span>
      {% endif %}
    </div>

    <!-- description + price -->
    <div class="flex items-start justify-between gap-3 mb-3">
      <p class="text-slate-300 text-sm leading-relaxed line-clamp-2">
        {{ products.description|truncatewords:22 }}
      </p>

      {% if products.price %}
        <div class="text-right shrink-0">
          <div class="text-emerald-400 font-semibold text-lg whitespace-nowrap">
            Rp {{ products.price|intcomma }}
          </div>
          {% if products.stock is not None %}
            <div class="text-[11px] {% if products.stock|default:0 > 0 %}text-emerald-500{% else %}text-rose-400{% endif %}">
              {% if products.stock|default:0 > 0 %}In stock{% else %}Out{% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>

      {% if user.is_authenticated and products.user == user %}
        <div class="flex items-center gap-3 text-sm">
          <a href="{% url 'main:edit_products' products.id %}" class="text-slate-300 hover:text-white">Edit</a>
          <a href="{% url 'main:delete_products' products.id %}" class="text-rose-400 hover:text-rose-300">Delete</a>
        </div>
      {% endif %}
    </div>
  </div>
</article>
